# Force Nixpacks to build ONLY the server workspace (monorepo: web + server)
# Key points:
# - Use npm install (not npm ci) to avoid EBUSY deleting mounted cache dirs
# - Install devDeps so tsc exists for build
# - Prune devDeps after build so runtime is production-only

[phases.install]
cmds = [
  "npm install --include=dev --prefer-offline --no-audit --no-fund"
]

[phases.build]
cmds = [
  "npm run build --workspace server",
  "npm prune --omit=dev"
]

[start]
cmd = "npm start --workspace server"
